name: fastforward main to latest release
on:
  push:
    branches:
      - main
jobs:
  sync-branch:
    name: Fast forward main to latest release branch
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0
      - name: Get latest branch
        run: |
          git fetch
          LATEST_RELEASE=$(git branch -a | grep -o "release-[[:digit:]].\([[:digit:]]*\)" | sed -e "s/^release-//" | sort -V | tail -n 1)
          echo "$LATEST_RELEASE"
          echo "LATEST_RELEASE=release-$LATEST_RELEASE" >> "$GITHUB_ENV"
      - uses: connor-baer/action-sync-branch@main
        name: Fastforward branch
        with:
          branch: ${{ env.LATEST_RELEASE }}
          token: ${{ secrets.GITHUB_TOKEN }}
          force: false
